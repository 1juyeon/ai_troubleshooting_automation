# SOLAPI 설정 가이드

## 📱 SOLAPI란?
SOLAPI는 국내 최고의 SMS/MMS 발송 서비스로, 안정적이고 빠른 문자 발송이 가능합니다.

## 🔐 인증 방식

SOLAPI는 API Key와 Secret을 쿼리 파라미터로 전달하는 방식을 사용합니다:

### 쿼리 파라미터 인증
- **방식**: API Key와 Secret을 URL 쿼리 파라미터로 전달
- **파라미터**: `apiKey`와 `apiSecret`를 요청 URL에 포함
- **보안**: HTTPS를 통한 안전한 전송

### 지원되는 인증 방식
- **쿼리 파라미터**: `?apiKey=XXX&apiSecret=XXX`
- **요청 본문**: 일부 API에서 요청 본문에 포함

### 인증 작동 원리
1. **API 키 설정**: SOLAPI 대시보드에서 API 키 생성
2. **파라미터 전달**: 요청 시 apiKey와 apiSecret 포함
3. **서버 검증**: SOLAPI 서버에서 인증 정보 검증
4. **권한 확인**: API 키의 권한 및 IP 제한 확인

### 권한 제한 시나리오
- **API 키 유효 + 권한 있음**: 모든 API 접근 가능
- **API 키 유효 + 권한 제한**: 일부 API만 접근 가능 (SMS 발송은 가능)
- **API 키 무효**: 모든 API 접근 불가

## 🔑 API 키 발급 방법

### 1. SOLAPI 계정 생성
- [SOLAPI 공식 사이트](https://solapi.com)에서 회원가입
- 본인인증 및 사업자등록증 등록 (필수)

### 2. 프로젝트 생성
- 대시보드 → "프로젝트" → "새 프로젝트 생성"
- 프로젝트명 입력 (예: "PrivKeeper SMS")

### 3. API 키 생성
- 프로젝트 선택 → "API 키 관리" → "새 API 키 생성"
- **API 키 형식**: `NCSBUQGP66BV505E` (20자리) 또는 `NCSFMJ9TRVXACUIW` (20자리 영문자+숫자)
- **API Secret 형식**: `OM6ZS1QYIRXCW8YOWWV7OS1Q1BUF4QAX` (32자리 영문자+숫자)
- **참고**: SOLAPI는 다양한 길이의 API 키를 지원합니다 (최소 16자리 이상)

### 4. API 키 권한 설정
- 생성된 API 키 선택 → "권한 설정" 클릭
- **필수 권한**: "SMS 발송" 체크박스 활성화
- **선택 권한**: "계정 조회", "프로젝트 조회" 등 필요에 따라 선택
- **저장**: 권한 설정 변경사항 저장

### 5. 발신자 번호 등록
- "발신번호 관리" → "새 발신번호 등록"
- 사용할 휴대폰 번호 입력 (예: 010-1234-5678)
- 인증번호 확인 후 등록 완료

## ⚠️ 중요 설정 사항

### API 키 보안
- **IP 제한 설정**: 프로덕션 환경에서는 허용 IP 주소 제한 권장
- **권한 설정**: SMS 발송 및 계정 조회 권한 확인
- **사용량 모니터링**: 월 사용량 및 비용 확인

### SMS 발송 권한 설정
- **필수 권한**: SMS 발송 권한이 반드시 활성화되어야 함
- **프로젝트 설정**: 프로젝트에서 SMS 발송이 허용되어야 함
- **발신자 번호**: 등록된 발신자 번호가 있어야 함
- **계정 상태**: 계정이 활성화되어 있어야 함

### 발신자 번호
- **사전 등록 필수**: SOLAPI에 등록된 발신자 번호만 사용 가능
- **인증 완료**: 본인인증이 완료된 번호만 사용 가능
- **형식**: 010-1234-5678 또는 01012345678

## �� PrivKeeper 연동 설정

### 1. Streamlit Cloud Secrets 설정
```toml
# .streamlit/secrets.toml
SOLAPI_API_KEY = "NCSFMJ9TRVXACUIW"
SOLAPI_API_SECRET = "HQGV2DZ4CC0UV7LZ2TWLW0O3VSHX53VO"
```

### 2. 사이드바 설정
- "SOLAPI API Key" 입력란에 API 키 입력
- "SOLAPI API Secret" 입력란에 API Secret 입력
- "발신자 번호" 입력란에 등록된 발신자 번호 입력

### 3. 연결 테스트
- "🔗 SOLAPI 연결 테스트" 버튼 클릭
- 성공 시: "✅ SOLAPI 연결 성공" 또는 "✅ SOLAPI 연결 성공 (API 키 유효, 권한 제한)" 메시지 표시
- 실패 시: 구체적인 오류 메시지와 해결 방법 제시

## 🚨 HTTP 400 오류 해결 방법

### 일반적인 원인과 해결책

#### 1. 잘못된 API 키 형식
- **증상**: HTTP 400 오류
- **원인**: API 키가 16자리 미만이거나 특수문자 포함
- **해결**: SOLAPI 대시보드에서 새로운 API 키 재생성
- **참고**: SOLAPI는 다양한 길이의 API 키를 지원합니다 (최소 16자리 이상)

#### 2. 인증 방식 오류
- **증상**: HTTP 400 또는 401 오류
- **원인**: API Key와 Secret을 쿼리 파라미터로 전달
- **해결 방법**:
  - API Key와 Secret이 정확한지 확인
  - SOLAPI 대시보드에서 API 키 상태 확인
  - 자동으로 쿼리 파라미터 방식으로 처리됨

#### 3. 발신자 번호 미등록
- **증상**: SMS 발송 시 HTTP 400 오류
- **원인**: SOLAPI에 등록되지 않은 발신자 번호 사용
- **해결**: SOLAPI 대시보드에서 발신자 번호 등록

#### 4. API 권한 부족
- **증상**: HTTP 401 또는 403 오류
- **원인**: API 키에 필요한 권한이 없음
- **해결 방법**:
  - SOLAPI 대시보드에서 API 키 권한 확인
  - 프로젝트 조회 권한이 있는지 확인
  - 필요시 새로운 API 키 생성

#### 5. HTTP 401 Unauthorized 오류
- **증상**: "권한이 없습니다" 메시지
- **원인**: API 키는 유효하지만 해당 API에 대한 권한 부족
- **해결 방법**:
  - SOLAPI 대시보드에서 API 키 권한 설정 확인
  - SMS 발송 권한이 활성화되어 있는지 확인
  - 계정 상태 및 결제 상태 확인
  - **중요**: 연결 테스트는 성공으로 간주 (API 키는 정상)

#### 6. SMS 발송 권한 부족
- **증상**: 연결 테스트는 성공하지만 SMS 발송 시 HTTP 401 오류
- **원인**: API 키에 SMS 발송 권한이 없음
- **해결 방법**:
  - SOLAPI 대시보드 → "API 키 관리" → 해당 API 키 선택
  - "권한 설정"에서 "SMS 발송" 권한 활성화
  - "프로젝트 설정"에서 SMS 발송 허용 확인
  - 필요시 새로운 API 키 생성 (SMS 발송 권한 포함)

#### 7. 권한 설정이 보이지 않는 경우
- **증상**: API 키 관리에서 권한 설정 옵션이 보이지 않음
- **원인**: SOLAPI 계정 유형이나 프로젝트 설정 문제
- **해결 방법**:
  - SOLAPI 고객센터에 문의 (1544-0708)
  - 계정 상태 및 프로젝트 설정 확인
  - 새로운 프로젝트 생성 후 API 키 재생성
  - **참고**: 일부 계정 유형에서는 권한 설정이 제한될 수 있음



## 📱 SMS 발송 방법

### 1. AI 분석 결과에서 발송
- "AI 분석 결과" 탭에서 분석 완료 후
- "수신자 이름"과 "수신자 전화번호" 입력
- "메시지 내용" 확인 및 수정
- "📱 SMS 발송" 버튼 클릭

### 2. 이력 관리에서 발송
- "이력 관리" 탭에서 특정 이력 선택
- "상세 보기" 클릭
- 모달에서 SMS 발송 정보 입력
- "📱 SMS 발송" 버튼 클릭

## 💰 요금 및 제한사항

### SMS 요금
- **국내 SMS**: 건당 약 20원 (사용량에 따라 할인)
- **MMS**: 건당 약 300원
- **월 사용량**: 무제한 (잔액 한도 내)

### 발송 제한
- **시간 제한**: 24시간 발송 가능
- **수량 제한**: 일일 발송 한도 없음
- **내용 제한**: 불법/스팸 내용 금지

## 🔍 문제 해결

### 연결 테스트 실패 시
1. **API 키 확인**: 최소 16자리 이상 영문자+숫자 형식인지 확인
2. **권한 확인**: SOLAPI 대시보드에서 API 키 권한 설정 확인
3. **인터넷 연결**: 네트워크 상태 확인
4. **SOLAPI 서버**: SOLAPI 서비스 상태 확인
5. **방화벽**: 회사/기관 방화벽 설정 확인

### SMS 발송 실패 시
1. **잔액 확인**: SOLAPI 계정 잔액 확인
2. **발신자 번호**: 등록된 발신자 번호인지 확인
3. **수신자 번호**: 올바른 휴대폰 번호 형식인지 확인
4. **메시지 내용**: 특수문자나 이모지 사용 제한

## 📞 고객 지원

### SOLAPI 고객센터
- **전화**: 1544-0708
- **이메일**: support@solapi.com
- **운영시간**: 평일 09:00-18:00

### PrivKeeper 지원
- **이메일**: support@privkeeper.com
- **문의**: GitHub Issues 또는 이메일

## 📚 추가 자료

- [SOLAPI 공식 문서](https://docs.solapi.com)
- [SOLAPI API 레퍼런스](https://docs.solapi.com/reference)
- [SOLAPI 개발자 가이드](https://docs.solapi.com/guides)
- [SOLAPI FAQ](https://solapi.com/faq)
